<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>src/store/store.js</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="../assets/css/logo.png" title="" width="117" height="52"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: </em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/api.html">api</a></li>
                                <li><a href="../classes/Hashes.html">Hashes</a></li>
                                <li><a href="../classes/Hashes.html">Hashes</a></li>
                                <li><a href="../classes/Hashes.html">Hashes</a></li>
                                <li><a href="../classes/Hashes.html">Hashes</a></li>
                                <li><a href="../classes/Hashes.html">Hashes</a></li>
                                <li><a href="../classes/Hashes.html">Hashes</a></li>
                                <li><a href="../classes/Hashes.RMD160.html">Hashes.RMD160</a></li>
                                <li><a href="../classes/Hashes.SHA256.html">Hashes.SHA256</a></li>
                                <li><a href="../classes/Hashes.SHA512.html">Hashes.SHA512</a></li>
                                <li><a href="../classes/.html"></a></li>
                                <li><a href="../classes/Popper.modifiers.fecha.html">Popper.modifiers.fecha</a></li>
                                <li><a href="../classes/Popper.modifiers.Hashes.RMD160.html">Popper.modifiers.Hashes.RMD160</a></li>
                                <li><a href="../classes/Popper.modifiers.Hashes.SHA256.html">Popper.modifiers.Hashes.SHA256</a></li>
                                <li><a href="../classes/Popper.modifiers.Hashes.SHA512.html">Popper.modifiers.Hashes.SHA512</a></li>
                                <li><a href="../classes/ReactClass.html">ReactClass</a></li>
                                <li><a href="../classes/ReactDOMTextComponent.html">ReactDOMTextComponent</a></li>
                                <li><a href="../classes/ReactMountReady.html">ReactMountReady</a></li>
                                <li><a href="../classes/ReactMultiChild.html">ReactMultiChild</a></li>
                                <li><a href="../classes/ReactOwner.html">ReactOwner</a></li>
                                <li><a href="../classes/ReactPropTransferer.html">ReactPropTransferer</a></li>
                                <li><a href="../classes/ReactReconcileTransaction.html">ReactReconcileTransaction</a></li>
                                <li><a href="../classes/ReactServerRenderingTransaction.html">ReactServerRenderingTransaction</a></li>
                                <li><a href="../classes/ReactShallowRenderer.html">ReactShallowRenderer</a></li>
                                <li><a href="../classes/ReactTestUtils.html">ReactTestUtils</a></li>
                                <li><a href="../classes/state.html">state</a></li>
                                <li><a href="../classes/Transaction.html">Transaction</a></li>
                            </ul>
                
                
                            <ul id="api-modules" class="apis modules">
                                <li><a href="../modules/Api.html">Api</a></li>
                                <li><a href="../modules/Store.html">Store</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: src/store/store.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
import Vue from &#x27;vue&#x27;
import Vuex from &#x27;vuex&#x27;
import api from &#x27;./api.js&#x27;
import router from &#x27;../router/index.js&#x27;

Vue.use(Vuex)
const apiRoot = &#x27;http://localhost:8000&#x27; // This will change if you deploy later
/**
 * This module contains classes for running a store.
 * @module Store
 */
const store = new Vuex.Store({
    /**
     * @class state
     * @type Object
     */
    state: {
        // 所有房间列表
        /**
         * @property rooms
         * @type Object
         */
        rooms: [],
        // 所有历史记录
        history: [],
        // 当前用户身份信息
        /**
         * @property account
         * @type String
         * @default &quot;null&quot;
         */
        account: null,
        /**
         * @property nickname
         * @type String
         * @default &quot;null&quot;
         */
        nickname: null,
        /**
         * @property isTeacher
         * @type Boolean
         * @default &quot;false&quot;
         */
        isTeacher: false,
        // 控制背景虚化，用于配合弹出窗口
        /**
         * @property background_blur
         * @type Boolean
         * @default &quot;false&quot;
         */
        background_blur: false,
        // 五种弹出模式窗口
        /**
         * @property showRegister
         * @type Boolean
         * @default &quot;false&quot;
         */
        showRegister: false,
        /**
         * @property showLogin
         * @type Boolean
         * @default &quot;false&quot;
         */
        showLogin: false,
        /**
         * @property showForget
         * @type Boolean
         * @default &quot;false&quot;
         */
        showForget: false,
        /**
         * @property showInfo
         * @type Boolean
         * @default &quot;false&quot;
         */
        showInfo: false,
        /**
         * @property showCreateRoom
         * @type Booleaan
         * @default &quot;false&quot;
         */
        showCreateRoom: false,
    },
    mutations: {
        /**
         * 获取房间到房间列表
         *
         *
         * @method GET_ROOMS
         * @param state {Object} An &#x60;state&#x60; Object
         * @param response {object} Get data object
         * @chainable
         */
        &#x27;GET_ROOMS&#x27;: function (state, response) {
            state.rooms = response.body
        },
        &#x27;ADD_ROOM&#x27;: function (state, response) {
            state.rooms.push(response.body)
        },
        &#x27;CLEAR_ROOMS&#x27;: function (state) {
            const rooms = state.rooms
            rooms.splice(0, rooms.length)
        },
        // Note that we added one more for logging out errors.
        /**
         * 获取房间的ID
         *
         *
         * @method GET_ROOM_ID
         * @param state {Object} An &#x60;state&#x60; Object
         * @param response {object} Get data object
         * @chainable
         */
        &#x27;GET_ROOM_ID&#x27;: function (state, response) {
            state.live_room_id = response.body.id
        },
        /**
         * 处理与后端通信时出现的错误
         *
         *
         * @method API_FAIL
         * @param state {Object} An &#x60;state&#x60; Object
         * @param error {object} Response an error
         * @chainable
         */
        &#x27;API_FAIL&#x27;: function (state, error) {
            Vue.prototype.$message({
                message: error.body.detail,
                type: &#x27;error&#x27;,
            })
            console.error(error)
        },
        /**
         * 处理成功注册的函数
         *
         *
         * @method Register_SUCC
         * @param state {Object} An &#x60;state&#x60; Object
         * @chainable
         */
        &#x27;Register_SUCC&#x27;: function (state) {
            Vue.prototype.$message({
                message: &#x27;注册成功！&#x27;,
                type: &#x27;success&#x27;,
            })
            state.showLogin = true
            state.showRegister = false
        },
        /**
         *  处理与后端通信时成功
         *
         *
         * @method API_SUCC
         * @param state {Object} An &#x60;state&#x60; Object
         * @chainable
         */
        &#x27;API_SUCC&#x27;: function (state, response) {
            Vue.prototype.$message({
                message: response.body.detail,
                type: &#x27;success&#x27;,
            })
        },
        /**
         *  处理成功登出的函数
         *
         *
         * @method LOGOUT_SUCC
         * @param state {Object} An &#x60;state&#x60; Object
         * @chainable
         */
        &#x27;LOGOUT_SUCC&#x27;: function (state) {
            Vue.prototype.$message({
                message: &#x27;登出成功！&#x27;,
                type: &#x27;success&#x27;,
            })
            state.account = null
            state.nickname = null
            state.isTeacher = false
            router.push(&#x27;/roomList&#x27;)
        },
        /**
         *  处理成功登录的函数，获取账户以及用户昵称
         *
         *
         * @method SUCC_LOGIN
         * @param state {Object} An &#x60;state&#x60; Object
         * @chainable
         */
        &#x27;SUCC_LOGIN&#x27;: function (state, response) {
            Vue.prototype.$message({
                type: &#x27;success&#x27;,
                message: &#x27;登录成功&#x27;
            })
            state.account = response.body[&#x27;account&#x27;]
            state.nickname = response.body[&#x27;nickname&#x27;]
            state.isTeacher = response.body[&#x27;is_teacher&#x27;]
            state.background_blur = false
            state.showLogin = false
            router.push(&#x27;/roomList&#x27;)
        },
        &#x27;GET_ROOMS_FAIL&#x27;: function (state, err) {
            Vue.prototype.$message({
                message: &#x27;获取直播房间失败&#x27;,
                type: &#x27;error&#x27;,
            })
        },
        /**
         *
         * @method trueBlur
         * @param state {Object} An &#x60;state&#x60; Object
         * @chainable
         */
        trueBlur: function (state) {
            state.background_blur = true
        },
        /**
         *
         * @method falseBlur
         * @param state {Object} An &#x60;state&#x60; Object
         * @chainable
         */
        falseBlur: function (state) {
            state.background_blur = false
        },
        /**
         *
         * @method trueRegister
         * @param state {Object} An &#x60;state&#x60; Object
         * @chainable
         */
        trueRegister: function (state) {
            state.showRegister = true
        },
        /**
         *
         * @method falseRegister
         * @param state {Object} An &#x60;state&#x60; Object
         * @chainable
         */
        falseRegister: function (state) {
            state.showRegister = false
        },
        /**
         *
         * @method trueLogin
         * @param state {Object} An &#x60;state&#x60; Object
         * @chainable
         */
        trueLogin: function (state) {
            state.showLogin = true
        },
        /**
         *
         * @method falseLogin
         * @param state {Object} An &#x60;state&#x60; Object
         * @chainable
         */
        falseLogin: function (state) {
            state.showLogin = false
        },
        /**
         *
         * @method trueForget
         * @param state {Object} An &#x60;state&#x60; Object
         * @chainable
         */
        trueForget: function (state) {
            state.showForget = true
        },
        /**
         *
         * @method falseForget
         * @param state {Object} An &#x60;state&#x60; Object
         * @chainable
         */
        falseForget: function (state) {
            state.showForget = false
        },
        /**
         *
         * @method trueCreateRoom
         * @param state {Object} An &#x60;state&#x60; Object
         * @chainable
         */
        trueCreateRoom: function (state) {
            state.showCreateRoom = true
        },
        /**
         *
         * @method falseCreateRoom
         * @param state {Object} An &#x60;state&#x60; Object
         * @chainable
         */
        falseCreateRoom: function (state) {
            state.showCreateRoom = false
        },
        /**
         * 获取登录用户信息
         *
         *
         * @method getUser
         * @param state {Object} An &#x60;state&#x60; Object
         * @param response {object} Get data object
         * @chainable
         */
        getUser: function (state, response) {
            if (response.body.account) {
                state.account = response.body[&#x27;account&#x27;]
                state.nickname = response.body[&#x27;nickname&#x27;]
                state.isTeacher = response.body[&#x27;isTeacher&#x27;]
            } else {
                state.account = null
                state.nickname = null
                state.isTeacher = false
            }
        },
        /**
         *
         * @method trueInfo
         * @param state {Object} An &#x60;state&#x60; Object
         * @chainable
         */
        trueInfo: function (state) {
            state.showInfo = true
        },
        /**
         *
         * @method falseInfo
         * @param state {Object} An &#x60;state&#x60; Object
         * @chainable
         */
        falseInfo: function (state) {
            state.showInfo = false
        },
        /**
         *
         * @method refreshNickname
         * @param state {Object} An &#x60;state&#x60; Object
         * @chainable
         */
        refreshNickname: function (state, nickname) {
            state.nickname = nickname
        },
        getHistory: function (state, response) {
            state.history = response.body
        },
        getHistoryFail: function (state) {
            Vue.prototype.$message({
                message: &#x27;获取录播房间失败&#x27;,
                type: &#x27;error&#x27;,
            })
            // this.$message(&#x27;fff&#x27;) ???
        }
    },
    actions: {
        // We added a getRooms action for the initial load from the server
        // These URLs come straight from the Django URL router we did in Part 3
        /**
         * 获取房间到房间列表
         *
         *
         * @method getRooms
         * @param store {Object} An &#x60;store&#x60; Object
         * @return {Object} The liveroom
         */
        getRooms (store) {
            return api.get(apiRoot + &#x27;/liveroom/&#x27;)
                .then((response) =&gt; store.commit(&#x27;GET_ROOMS&#x27;, response))
                .catch((error) =&gt; store.commit(&#x27;GET_ROOMS_FAIL&#x27;, error))
        },
        getHistory (state) {
            return api.get(apiRoot + &#x27;/history/&#x27;)
                .then((response) =&gt; store.commit(&#x27;getHistory&#x27;, response))
                .catch((error) =&gt; store.commit(&#x27;getHistoryFail&#x27;, error))
        },
        addRoom (store, room) {
            return api.post(apiRoot + &#x27;/rooms/&#x27;, room)
                .then((response) =&gt; store.commit(&#x27;ADD_ROOM&#x27;, response))
                .catch((error) =&gt; store.commit(&#x27;API_FAIL&#x27;, error))
        },
        clearRooms (store) {
            return api.delete(apiRoot + &#x27;/rooms/clear_rooms/&#x27;)
                .then((response) =&gt; store.commit(&#x27;CLEAR_ROOMS&#x27;))
                .catch((error) =&gt; store.commit(&#x27;API_FAIL&#x27;, error))
        },
        /**
         * 用户登录的检测是否成功
         *
         *
         * @method loginUser
         * @param store {Object} An &#x60;store&#x60; Object
         * @param userinfo {Object} An &#x60;userinfo&#x60; Object
         * @return {Object} The result
         */
        loginUser (store, userinfo) {
            return api.post(apiRoot + &#x27;/users/login_users/&#x27;, userinfo)
                .then((response) =&gt; store.commit(&#x27;SUCC_LOGIN&#x27;, response))
                .catch((error) =&gt; store.commit(&#x27;API_FAIL&#x27;, error))
        },
        /**
         * 用户注册的检测是否成功
         *
         *
         * @method RegisterUser
         * @param store {Object} An &#x60;store&#x60; Object
         * @param userinfo {Object} An &#x60;userinfo&#x60; Object
         * @return {Object} The result
         */
        registerUser (store, userinfo) {
            return api.post(apiRoot + &#x27;/users/&#x27;, userinfo)
                .then((response) =&gt; store.commit(&#x27;Register_SUCC&#x27;, userinfo))
                .catch((error) =&gt; store.commit(&#x27;API_FAIL&#x27;, error))
        },
        /**
         * 用户修改昵称，并且保存在后端
         *
         *
         * @method changeNick
         * @param store {Object} An &#x60;store&#x60; Object
         * @param userinfo {Object} An &#x60;userinfo&#x60; Object
         * @return {Object} The result
         */
        changeNick (store, userinfo) {
            userinfo.account = store.state.account
            return api.patch(apiRoot + &#x27;/users/change_info/&#x27;, userinfo)
                .then((response) =&gt; {
                    store.commit(&#x27;API_SUCC&#x27;, response)
                    store.commit(&#x27;refreshNickname&#x27;, userinfo.nickname)
                })
                .catch((error) =&gt; store.commit(&#x27;API_FAIL&#x27;, error))
        },
        /**
         * 用户修改密码，检测是否成功，并且保存在后端
         *
         *
         * @method changePasswd
         * @param store {Object} An &#x60;store&#x60; Object
         * @param userinfo {Object} An &#x60;userinfo&#x60; Object
         * @return {Object} The result
         */
        changePasswd (store, userinfo) {
            return api.patch(apiRoot + &#x27;/users/change_info/&#x27;, userinfo)
                .then((response) =&gt; store.commit(&#x27;API_SUCC&#x27;, response))
                .catch((error) =&gt; store.commit(&#x27;API_FAIL&#x27;, error))
        },
        /**
         * 用户发送验证码
         *
         *
         * @method sendVertificateCode
         * @param store {Object} An &#x60;store&#x60; Object
         * @param vertificateInfo {Object} An &#x60;vertificateInfo&#x60; Object
         * @return {Object} The result
         */
        sendVertificateCode (store, vertificateInfo) {
            return api.post(apiRoot + &#x27;/users/sendVertificateCode/&#x27;, vertificateInfo)
                .then((response) =&gt; store.commit(&#x27;API_SUCC&#x27;, response))
                .catch((error) =&gt; store.commit(&#x27;API_FAIL&#x27;, error))
        },
        /**
         * 用户忘记密码
         *
         *
         * @method forgetPassword
         * @param store {Object} An &#x60;store&#x60; Object
         * @param  info {Object} An &#x60; info&#x60; Object
         * @return {Object} The result
         */
        forgetPassword (store, info) {
            return api.patch(apiRoot + &#x27;/users/forget_info/&#x27;, info)
                .then((response) =&gt; store.commit(&#x27;API_SUCC&#x27;, response))
                .catch((error) =&gt; store.commit(&#x27;API_FAIL&#x27;, error))
        },
        /**
         * 用户成功登出
         *
         *
         * @method logout
         * @param store {Object} An &#x60;store&#x60; Object
         * @return {Object} The result
         */
        logout (store) {
            return api.post(apiRoot + &#x27;/users/logout_user/&#x27;)
                .then((response) =&gt; store.commit(&#x27;LOGOUT_SUCC&#x27;))
                .catch((error) =&gt; store.commit(&#x27;API_FAIL&#x27;, error))
        },
        /**
         * 打开注册窗口
         *
         *
         * @method openRegisterDialog
         */
        openRegisterDialog: function () {
            store.commit(&#x27;trueRegister&#x27;)
            store.commit(&#x27;trueBlur&#x27;)
        },
        /**
         * 关闭注册窗口
         *
         *
         * @method closeRegisterDialog
         */
        closeRegisterDialog: function () {
            store.commit(&#x27;falseRegister&#x27;)
            store.commit(&#x27;falseBlur&#x27;)
        },
        /**
         * 打开登录窗口
         *
         *
         * @method openLoginDialog
         */
        openLoginDialog: function () {
            store.commit(&#x27;trueLogin&#x27;)
            store.commit(&#x27;trueBlur&#x27;)
        },
        /**
         * 打开忘记密码窗口
         *
         *
         * @method openForgetDialog
         */
        openForgetDialog: function () {
            store.commit(&#x27;trueForget&#x27;)
            store.commit(&#x27;trueBlur&#x27;)
        },
        /**
         * 关闭忘记密码窗口
         *
         *
         * @method closeForgetDialog
         */
        closeForgetDialog: function () {
            store.commit(&#x27;falseForget&#x27;)
            store.commit(&#x27;falseBlur&#x27;)
        },
        /**
         * 关闭登录窗口
         *
         *
         * @method closeLoginDialog
         */
        closeLoginDialog: function () {
            store.commit(&#x27;falseLogin&#x27;)
            store.commit(&#x27;falseBlur&#x27;)
        },
        /**
         * 打开创建直播间窗口
         *
         *
         * @method openCreateRoomDialog
         */
        openCreateRoomDialog: function () {
            store.commit(&#x27;trueCreateRoom&#x27;)
            store.commit(&#x27;trueBlur&#x27;)
        },
        /**
         * 关闭创建直播间窗口
         *
         *
         * @method closeCreateRoomDialog
         */
        closeCreateRoomDialog: function () {
            store.commit(&#x27;falseCreateRoom&#x27;)
            store.commit(&#x27;falseBlur&#x27;)
        },
        /**
         * 获取用户从后端
         *
         *
         * @method getUserFromDjango
         * @return {Object} The result
         */
        getUserFromDjango: function () {
            return api.post(apiRoot + &#x27;/users/current_user/&#x27;)
                .then((response) =&gt; store.commit(&#x27;getUser&#x27;, response))
                .catch((error) =&gt; store.commit(&#x27;API_FAIL&#x27;, error))
        },
        /**
         * 打开个人信息窗口
         *
         *
         * @method openInfoDialog
         */
        openInfoDialog: function () {
            store.commit(&#x27;trueInfo&#x27;)
            store.commit(&#x27;trueBlur&#x27;)
        },
        /**
         * 关闭个人信息窗口
         *
         *
         * @method closeInfoDialog
         */
        closeInfoDialog: function () {
            store.commit(&#x27;falseInfo&#x27;)
            store.commit(&#x27;falseBlur&#x27;)
        },
        startLive: function (store, roomInfo) {
            return api.patch(apiRoot + &#x27;/liveroom/start_live/&#x27;, roomInfo)
                .then((response) =&gt; store.commit(&#x27;API_SUCC&#x27;, response))
                .catch((error) =&gt; store.commit(&#x27;API_FAIL&#x27;, error))
        },
        stopLive: function (store, roomInfo) {
            return api.patch(apiRoot + &#x27;/liveroom/stop_live/&#x27;, roomInfo)
                .then((response) =&gt; store.commit(&#x27;API_SUCC&#x27;, response))
                .catch((error) =&gt; store.commit(&#x27;API_FAIL&#x27;, error))
        },
    }
})

export default store

    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
